<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Travel Page</title>

    <link rel="stylesheet" href="houstonToVegas.css" type="text/css" />
    <link href="https://fonts.googleapis.com/css?family=Montserrat&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Pacifico&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script   src="https://code.jquery.com/jquery-3.4.1.min.js"   integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="   crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="moment.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

</head>
<body>
    
    <style>
        body{
            font-family: 'Montserrat', sans-serif;
            color: black;
            font-weight: 900;
            font-style: normal;
            font-family: 'Montserrat', sans-serif;

        }
        .row{
            border-bottom: 1px dotted black;
        }

        .btn{
            height: 100%;
        }
        
    </style>
    <script>
        $( function() {
            $(".datepicker" ).datepicker();
        }); 

    </script>
    

    <div class="container-fluid">
            <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
                    <ol class="carousel-indicators">
                      <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                      <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
                      <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
                    </ol>
                    <div class="carousel-inner">
                      <div class="carousel-item active">
                        <img class="d-block w-100" src="bgimg1.jpg" alt="First slide"><div class='imgText'>Travel</div>
                      </div>
                      <div class="carousel-item">
                        <img class="d-block w-100" src="bgimg2.jpg" alt="Second slide"><div class='imgText'>Learn</div>
                      </div>
                      <div class="carousel-item">
                        <img class="d-block w-100" src="bgimg3.jpg" alt="Third slide"><div class='imgText'>Explore</div>
                      </div>
                    </div>
                    <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                      <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                      <span class="carousel-control-next-icon" aria-hidden="true"></span>
                      <span class="sr-only">Next</span>
                    </a>
                  </div>
        <div class="col">
            <div class="row justify-content-center"><h3>Choose a city below: </h3></div>
            <div class="row">
                <div class="col-md-6">
                    <div class="row">
                         Select your city of Residence:
                    </div>
                     <div class="row text-center">
                         <div class="col-12 col-sm-4">
                             <input type="radio" name="cityFrom" value="LAS" checked/>
                             <label for="vegas">Vegas</label>
                         </div>
                         <div class="col-12  col-sm-4">
                             <input type="radio" name="cityFrom" value="IAH" />
                             <label for="houston">Houston</label>
                         </div>
                         <div class="col-12  col-sm-4">
                            <input type="radio" name="cityFrom" value="ORD" />
                            <label for="chicago">Chicago</label>
                         </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="row">
                         Select your city of your loved one:
                    </div>
                    <div class="row text-center">
                         <div class="col-12 col-sm-4">
                             <input type="radio" name="cityTo" value="LAS" />
                             <label for="vegas">Vegas</label>

                         </div>
                         <div class="col-12  col-sm-4">
                             <input type="radio" name="cityTo" value="IAH" checked/>
                             <label for="houston">Houston</label>
                         </div>
                         <div class="col-12  col-sm-4">
                            <input type="radio" name="cityTo" value= "ORD" />
                            <label for="chicago">Chicago</label>
                         </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-4">
                    <div class="row">
                        Please select the Date of Departure:
                    </div>
                    <div class="row">
                        <input type="text" class="datepicker" name="tripStart" required/>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="row">
                        Please select the Date of Return: 
                    </div>
                    <div class="row">
                        <input type="text" class="datepicker" name="tripEnd" required/>
                    </div>
                </div>
                <div class="col-md-4 p-0">
                    <div class="row justify-content-center m-0"> 
                        <input type="button" onClick="validate()" class="btn btn-lg btn-secondary btn-block" value="Submit"/>
                    </div>
                 </div>
            </div>
           
             <div class="row" id="flightsDepart">
                5 Cheapest Flights Departing
            </div>
            
            <div class="row" id="flightsReturn">
                5 Cheapest Flights Returning
            </div>
           
        </div>
     </div>

    <script>

        function validate()
        {
            var dateFrom = $("[name=tripStart]").val();
            var dateTo = $("[name=tripEnd]").val();
            var cityFrom = $("input[name='cityFrom']:checked").val();
            var cityTo = $("input[name='cityTo']:checked").val();
            var dateFromArray = dateFrom.split("/");
            var dateToArray = dateTo.split("/");

            var dayFrom = dateFromArray[1];
            var monthFrom = dateFromArray[0];
            var yearFrom = dateFromArray[2];
            var dayTo = dateToArray[1];
            var monthTo = dateToArray[0];
            var yearTo = dateToArray[2];

            var today = new Date();
            var todayDay = parseInt(today.getDate());
            var todayMonth = parseInt(today.getMonth()+1);
            var todayYear = parseInt(today.getFullYear());



            if(parseInt(yearFrom) < todayYear)
            {
                alert("Departing date must be greater than or equal to today")
            }
            else if (parseInt(monthFrom) < todayMonth)
            {
                alert("Departing date must be greater than or equal to today")
            }
            else if (parseInt(dayFrom) < todayDay)
            {
                alert("Departing date must be greater than or equal to today")
            }
            else if (cityFrom == cityTo)
            {
                alert("You must choose two different cities");
            }
            else if (yearTo < yearTo)
            {
                alert("the date of return must be after the date of departure");
            }
            else if( monthTo < monthFrom)
            {
                alert("the date of return must be after the date of departure");
            }
            else if( dayTo <= dayFrom)
            {
                alert("the date of return must be after the date of departure");
            }
            else
                onSubmit2();

        }




        function onSubmit2()
         {
            var dateFrom = $("[name=tripStart]").val();
            var dateTo = $("[name=tripEnd]").val();
            var cityFrom = $("input[name='cityFrom']:checked").val();
            var cityTo = $("input[name='cityTo']:checked").val();
            var dateFromArray = dateFrom.split("/");
            var dateToArray = dateTo.split("/");
        

           

            var dayFrom = dateFromArray[1];
            var monthFrom = dateFromArray[0];
            var yearFrom = dateFromArray[2];

            var dayTo = dateToArray[1];
            var monthTo = dateToArray[0];
            var yearTo = dateToArray[2];
                                                               

            console.log(dayFrom + " " + monthFrom + " " + yearFrom + " " + dayTo + " " + monthTo + " " + yearTo);
            var urlFrom =  "https://api.skypicker.com/flights?flyFrom=" + cityFrom+ "&to=" + cityTo + "&dateTo=" + dayFrom + "/" + monthFrom + "/" + yearFrom + "&partner=picky";

            console.log(urlFrom);

            $.ajax({
                url: urlFrom,
                type: 'GET',
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    console.log(data.data);
                    for (var i = 4; i >= 0; i--) {
                        try
                        {
                        var airlineFrom = data.data[i].airlines[0];
                        var timeDepartFrom =  moment.unix(data.data[i].dTimeUTC)._d;
                        var timeArriveFrom = moment.unix(data.data[i].aTimeUTC)._d;
                        var costFrom = data.data[i].price;
                        var deeplinkFrom = data.data[i].deep_link;
                        }catch (err)
                        {
                            alert("There was an error with the date of departure, please choose a different date of departure. The page will be reloaded now.")
                            location.reload()
                        }

                        switch (airlineFrom) {
                            case "NK":
                                airlineFrom = "Spirit";
                                break
                            case "UA":
                                airlineFrom = "United";
                                break
                            case "F9":
                                airlineFrom = "Frontier";
                                break
                             case "DL":
                                airlineFrom = "Delta";
                                break
                            case "AA":
                                airlineFrom = "American Airlines";
                                break
                            default:
                                airlineFrom = airlineFrom;
                        }
                      

                        if (data.data[i].route.length > 1) {
                            var layoverListFrom = [];
                            for (var j = 0; j < data.data[i].route.length; j++) {
                                layoverListFrom.push(data.data[i].route[j].cityTo);
                            }
                        }

                        var layoverStringFrom;

                        if (layoverListFrom && layoverListFrom.length == 1) {
                            layoverStringFrom = layoverListFrom[0];
                        }
                        else if (layoverListFrom && layoverListFrom.length > 1) {
                            layoverStringFrom = layoverListFrom[0];
                            for (var z = 1; z < layoverListFrom.length - 1; z++) {

                                layoverStringFrom += ", " + layoverListFrom[z];
                            }
                        }
                        else
                            layoverStringFrom = "No Layovers, lucky you!";

                        $("#flightsDepart").after('<div class="row"></div>');
                        $("#flightsDepart").next().append('<div class="col-md-3"> <div class="row">'+airlineFrom+'</div></div> ');
                        $("#flightsDepart").next().append('<div class="col-md-5"> <div class="row">' + timeDepartFrom + ' to ' + timeArriveFrom + '</div></div> ');
                        $("#flightsDepart").next().append('<div class="col-md-3"> <div class="row">' + layoverStringFrom + '</div></div> ');
                        $("#flightsDepart").next().append('<div class="col-md-1"> <div class="row"><a href="'+deeplinkFrom+'">'+costFrom+' Euros'+'</a></div></div> ');

                    }
                   
                },
                error: function () {
                    alert("Hmm, something went wrong. Just google it. :)");
                },
                
            });


            var urlTo =  "https://api.skypicker.com/flights?flyFrom=" + cityTo+ "&to=" + cityFrom + "&dateTo=" + dayTo + "/" + monthTo + "/" + yearTo + "&partner=picky";
            
            $.ajax({
                url: urlTo,
                type: 'GET',
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    console.log(data.data);
                    for (var i = 4; i >= 0; i--) {
                        try{
                        var airlineTo = data.data[i].airlines[0];
                        var timeDepartTo = moment.unix(data.data[i].dTimeUTC)._d;
                        var timeArriveTo = moment.unix(data.data[i].aTimeUTC)._d;
                        var costTo = data.data[i].price;
                        var deeplinkTo = data.data[i].deep_link;
                        }catch (err)
                        {
                            alert("There was an error with the date of return, please choose a different date of return. The page will be reloaded now.")
                            location.reload()
                        }


                        switch (airlineTo) {
                            case "NK":
                                airlineTo = "Spirit";
                                break
                            case "UA":
                                airlineTo = "United";
                                break
                            case "F9":
                                airlineTo = "Frontier";
                                break
                             case "DL":
                                airlineTo = "Delta";
                                break
                            case "AA":
                                airlineTo = "American Airlines";
                                break
                            default:
                                airlineTo = airlineTo;
                        }
                        
                       if (data.data[i].route.length > 1) {
                            var layoverListTo = [];
                            for (var j = 0; j < data.data[i].route.length; j++) {
                                layoverListTo.push(data.data[i].route[j].cityTo);
                            }
                        }

                        var layoverStringTo;

                        if (layoverListTo && layoverListTo.length == 1) {
                            layoverStringTo = layoverListTo[0];
                        }
                        else if (layoverListTo && layoverListTo.length > 1) {
                            layoverStringTo = layoverListTo[0];
                            for (var z = 1; z < layoverListTo.length - 1; z++) {

                                layoverStringTo += ", " + layoverListTo[z];
                            }
                        }
                        else
                            layoverStringTo = "No Layovers, lucky you!";

                        $("#flightsReturn").after('<div class="row"></div>');
                        $("#flightsReturn").next().append('<div class="col-md-3"> <div class="row">'+airlineTo+'</div></div> ');
                        $("#flightsReturn").next().append('<div class="col-md-5"> <div class="row">' + timeDepartTo + ' to ' + timeArriveTo + '</div></div> ');
                        $("#flightsReturn").next().append('<div class="col-md-3"> <div class="row">' + layoverStringTo + '</div></div> ');
                        $("#flightsReturn").next().append('<div class="col-md-1"> <div class="row"><a href="'+deeplinkTo+'">'+costTo+' Euros'+'</a></div></div> ');

                    }
                   
                },
                error: function () {
                    alert("Hmm, something went wrong. Just google it. :)");
                },
                
            });

        }


    </script>
</body>
</html>